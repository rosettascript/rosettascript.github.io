<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Random Universe Cipher</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script type="module" crossorigin src="./assets/index-CHdsNm_x.js"></script>
  <link rel="stylesheet" crossorigin href="./assets/index-DR4xltMW.css">
  <link rel="stylesheet" href="./theme-override.css">
  <base href="./">
  <script>
    // Sync theme with parent page
    (function() {
      const syncTheme = () => {
        try {
          // Check if we're in an iframe and can access parent
          if (window.parent !== window) {
            const parentDoc = window.parent.document;
            const isDark = parentDoc.documentElement.classList.contains('dark') || 
                          parentDoc.body.classList.contains('dark');
            if (isDark) {
              document.documentElement.classList.add('dark');
            } else {
              document.documentElement.classList.remove('dark');
            }
          } else {
            // Check system preference if not in iframe
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (prefersDark) {
              document.documentElement.classList.add('dark');
            } else {
              document.documentElement.classList.remove('dark');
            }
          }
        } catch (e) {
          // Cross-origin or other error, use system preference
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (prefersDark) {
            document.documentElement.classList.add('dark');
          }
        }
      };
      
      // Sync on load
      syncTheme();
      
      // Watch for theme changes in parent
      if (window.parent !== window) {
        try {
          const observer = new MutationObserver(syncTheme);
          observer.observe(window.parent.document.documentElement, {
            attributes: true,
            attributeFilter: ['class']
          });
        } catch (e) {
          // Can't observe parent, just use initial sync
        }
      }
      
      // Watch system preference changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', syncTheme);
    })();
    
    // Fix worker path resolution for iframe context
    (function() {
      const originalWorker = self.Worker;
      self.Worker = function(scriptURL, options) {
        try {
          // If it's a URL object with absolute path, convert to relative
          if (scriptURL instanceof URL) {
            const pathname = scriptURL.pathname;
            if (pathname.startsWith('/assets/')) {
              const filename = pathname.split('/assets/')[1];
              scriptURL = new URL('./assets/' + filename, document.baseURI || window.location.href);
            }
          } else if (typeof scriptURL === 'string') {
            // Handle string paths
            if (scriptURL.startsWith('/assets/')) {
              scriptURL = './assets/' + scriptURL.split('/assets/')[1];
            } else if (scriptURL.startsWith('/')) {
              // Other absolute paths - make relative
              scriptURL = '.' + scriptURL;
            }
          }
        } catch (e) {
          console.warn('Worker path fix failed:', e);
        }
        return new originalWorker(scriptURL, options);
      };
      // Also patch for SharedWorker if needed
      if (self.SharedWorker) {
        const originalSharedWorker = self.SharedWorker;
        self.SharedWorker = function(scriptURL, options) {
          if (typeof scriptURL === 'string' && scriptURL.startsWith('/assets/')) {
            scriptURL = './assets/' + scriptURL.split('/assets/')[1];
          }
          return new originalSharedWorker(scriptURL, options);
        };
      }
    })();
  </script>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <h1>üîê Random Universe Cipher</h1>
      <div class="specs">
        <div class="spec"><span class="label">Key:</span><span class="value">512-bit</span></div>
        <div class="spec"><span class="label">Block:</span><span class="value">256-bit</span></div>
        <div class="spec"><span class="label">Rounds:</span><span class="value">24</span></div>
        <div class="spec"><span class="label">AEAD + Argon2</span></div>
      </div>
    </header>

    <!-- Password -->
    <section>
      <h2><span class="icon">üîë</span> Password</h2>
      <div class="password-input-container">
        <div class="input-group">
          <input type="password" id="password" placeholder="Enter password...">
        </div>
        <button class="btn btn-primary" id="generate-key">üé≤ Random</button>
      </div>
      <div class="security-options">
        <label>
          <input type="checkbox" id="use-aead" checked>
          <span>üõ°Ô∏è AEAD</span>
        </label>
        <label>
          <input type="checkbox" id="use-argon2" checked>
          <span>üîë Argon2</span>
        </label>
        <span id="salt-display" style="color: var(--text-muted); white-space: nowrap;"></span>
      </div>
    </section>

    <!-- Text Encrypt/Decrypt - Side by Side -->
    <div class="encrypt-decrypt-grid">
      <section>
        <h2><span class="icon">üîí</span> Encrypt</h2>
        <div class="input-group">
          <textarea id="plaintext" placeholder="Enter text to encrypt..."></textarea>
        </div>
        <button class="btn btn-primary" id="encrypt-btn" style="width: 100%;">‚ö° Encrypt</button>
        <div class="output-container">
          <div class="output" id="encrypt-output"></div>
          <button class="copy-btn" id="copy-ciphertext">Copy</button>
        </div>
      </section>

      <section>
        <h2><span class="icon">üîì</span> Decrypt</h2>
        <div class="input-group">
          <textarea id="ciphertext" placeholder="Paste ciphertext..."></textarea>
        </div>
        <button class="btn btn-primary" id="decrypt-btn" style="width: 100%;">‚ö° Decrypt</button>
        <div class="output-container">
          <div class="output" id="decrypt-output"></div>
          <button class="copy-btn" id="copy-plaintext">Copy</button>
        </div>
      </section>
    </div>

    <!-- File Encryption -->
    <section>
      <h2><span class="icon">üìÅ</span> File Encryption</h2>
      
      <div id="drop-zone" class="drop-zone">
        <div class="drop-zone-content">
          <div class="drop-icon">üìÇ</div>
          <div class="drop-text">Drop file here or click to select</div>
        </div>
        <input type="file" id="file-input" style="display: none;">
      </div>
      
      <div id="file-info" class="file-info" style="display: none;">
        <div class="file-details">
          <span class="file-icon">üìÑ</span>
          <div>
            <div id="file-name" class="file-name">filename.txt</div>
            <div id="file-size" class="file-size">0 KB</div>
          </div>
        </div>
        <button class="btn btn-small" id="clear-file">‚úï</button>
      </div>
      
      <div class="btn-group" style="margin-top: 0.75rem;">
        <button class="btn btn-primary" id="encrypt-file-btn" disabled style="flex: 1;">üîí Encrypt</button>
        <button class="btn btn-secondary" id="decrypt-file-btn" disabled style="flex: 1;">üîì Decrypt</button>
      </div>
      
      <div id="file-progress" class="file-progress" style="display: none;">
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <div id="progress-text" class="progress-text">Processing...</div>
      </div>
      
      <div id="file-output" class="file-output" style="display: none;">
        <div class="file-output-icon">‚úÖ</div>
        <div id="file-output-text">Success!</div>
        <button class="btn btn-primary btn-small" id="download-file-btn">‚¨áÔ∏è Download</button>
      </div>
    </section>

    <!-- Performance -->
    <section>
      <h2><span class="icon">üìä</span> Performance</h2>
      <div class="stats">
        <div class="stat-card">
          <div class="label">Key</div>
          <div class="value" id="key-time">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Encrypt</div>
          <div class="value" id="enc-time">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Decrypt</div>
          <div class="value" id="dec-time">-</div>
        </div>
        <div class="stat-card">
          <div class="label">Speed</div>
          <div class="value" id="throughput">-</div>
        </div>
      </div>
    </section>

    <!-- Security Test -->
    <section>
      <h2><span class="icon">üî¨</span> Security Test</h2>
      <div style="display: flex; gap: 0.5rem; align-items: center;">
        <button class="btn btn-secondary btn-small" id="run-avalanche">üåä Avalanche Test</button>
        <span id="avalanche-results" style="font-size: 0.75rem; color: var(--text-muted);">Click to test bit propagation</span>
      </div>
    </section>

    <!-- About - Collapsible -->
    <section>
      <h2 class="section-toggle" onclick="this.classList.toggle('collapsed'); this.nextElementSibling.classList.toggle('collapsed');">
        <span class="icon">‚ÑπÔ∏è</span> About
      </h2>
      <div class="section-content about-content">
        <p><strong>Random Universe Cipher</strong> - 256-bit quantum-resistant symmetric encryption.</p>
        <ul>
          <li>7 √ó 512-bit state registers with GF(2‚Å∏) operations</li>
          <li>24 rounds with key-derived S-boxes</li>
          <li>SHAKE256 keystream + ChaCha20 PRNG</li>
          <li>AEAD (HMAC-SHA256) + Argon2id KDF</li>
        </ul>
        <p style="color: var(--warning); margin-top: 0.5rem;">‚ö†Ô∏è Demo only - not audited for production use.</p>
      </div>
    </section>
  </div>

</body>
</html>
